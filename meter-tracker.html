<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electricity Meter Tracker</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkVsZWN0cmljaXR5IE1ldGVyIFRyYWNrZXIiLAogICJzaG9ydF9uYW1lIjogIk1ldGVyVHJhY2tlciIsCiAgImRlc2NyaXB0aW9uIjogIlRyYWNrIHlvdXIgZHVhbCBlbGVjdHJpY2l0eSBtZXRlcnMgYW5kIG1hbmFnZSAyMDAtdW5pdCBsaW1pdCIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzAwNzNlNiIsCiAgInRoZW1lX2NvbG9yIjogIiMwMDczZTYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MG5hSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY25JSGJXVG5CdmNuUTlKekF1TURCV2FXVJM4OVRLVjJaaGJYWXZNalo1U2k0NE9VZGtNVEptU0VwMFluZEVTRmRzYlhoT09WRW5QaUE4Y21WamRDQjNhV1IwYUQwbk1qUW5JRzVsYVdkb2REMG5NalFuSUdacGJHdzlKekF3TnpObE5pZHZjR0ZqYVhSNVBTY3VOaWN2UGlBOFptOXlaV2xuYmlCdmFtcGxZM1E5SjI5d1lXTnBkSGtwSnlBNFBtWnZjbVZwWjI0Z1pHRjBZVDBuYVcxaFoyVXZjM1puSzNoNGJXdzdZbUZ6WlRZMExDQjJjR1p2UTNKR1NESjRaVTR6UVZCRU4wZEdXR3g0UTFGT01sRkhkMk5hVUhoRU0yMXJRa016UTJsS1JrOWFjMVJUVVRVMFVrZFJZVVpsVlZSaVFUSXlWVzkxYmk0OEwybHRZV2RsSUQ0Z1BITjJaeUJ6YVhwbFBTY3hPQ2NnZEdocGN6MG5NVFF1TlNjZ1pHRjBZUzF1WVcxbFBTZEljbVZsYmlCSE0wUmthR1p1U1dKa2JVWmpTblE0VEdOdVVWZEViRzl6VWs5eGJGWnhUV3AyYkZaMVdUTnNaV1ozUkZaR2JVNTNZWFZ0V0VsS1ZVOXdWUzFOYmpZMlNHbGlXRTEzWTBkVmFGWm5WRE5uTkdwTVNWVklhUzFRVVdFOVB5ZGdaaUE4VUVGVVNFZ2dSRjA5SjIweFJrUmpRakk0U3kwemUwdERPVGxNTVVwWldWQnphMXBsTmtaWGIzaDFhbVZKYzJ4MkIxY2dOSEJhUzBjdFVFUllWV2RFU25VdGRYVnNOMHA2U21wRlNFbzNObGt5UzBaR1ZGRmhkU0VqTXpVNFFUTkdOelk0Y2tGV1NuSTVUamt1Tm1vMVkxQnRaa1l5TkVGTE5FNVlRa1ZGVTNJdGJsWTRhRFl1Tld0OVBB';CiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAic2l6ZXMiOiAiYW55IgogICAgfQogIF0KfQ==">
    <meta name="theme-color" content="#0073e6">
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZQTFRF////AAAA8J2s4wAAAAJ0Uk5TAP9bkSK1AAABjklEQVR42u3WQRHCQAxA0S9kIQtZyEIWspCFLGQhC1nIQhay8P//wDdZSEIWspCFLGQhC1nIQhay8P//wDdZSEIWspCFLGQhC1nIQhay8P//wDdZSEIWspCFLGQhC1nIQhay8P//wDdZSEIWspCFLGQhC1nIQhay8P//wDdZSEIWspCFLGQhC1nIQhayEIWshC1nIQhby8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhayEIWshC1nIQhZy8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhayEIWshC1nIQhZy8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZSEIWshCFLGQhC1nIQhayEIWshC1nIQhZy8P//wDdZSEIWshCFLGQhC1nIQhay8P//wDdZ">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind for better mobile support
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'xs': '475px',
                    }
                }
            }
        }
    </script>
    <style>
        /* PWA specific styles */
        body {
            overscroll-behavior: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Better touch targets for mobile */
        button, input, select {
            min-height: 44px;
            touch-action: manipulation;
        }
        
        /* Hide scrollbars but keep functionality */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Mobile-optimized cards */
        .meter-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .meter-card:active {
            transform: scale(0.98);
        }
        
        /* Install prompt styles */
        .install-prompt {
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <!-- Service Worker Registration -->
    <script>
        // Register service worker for offline functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        let installPromptShown = false;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!installPromptShown) {
                showInstallPrompt();
                installPromptShown = true;
            }
        });
        
        function showInstallPrompt() {
            if (localStorage.getItem('installPromptDismissed')) return;
            
            const prompt = document.createElement('div');
            prompt.className = 'install-prompt fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg z-50';
            prompt.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold">Install App</h4>
                        <p class="text-sm opacity-90">Add to home screen for quick access</p>
                    </div>
                    <div class="flex gap-2 ml-4">
                        <button onclick="installApp()" class="bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium">Install</button>
                        <button onclick="dismissInstallPrompt(this)" class="text-white opacity-75 hover:opacity-100">Ã—</button>
                    </div>
                </div>
            `;
            document.body.appendChild(prompt);
            
            setTimeout(() => {
                prompt.style.animation = 'slideUp 0.3s ease';
            }, 1000);
        }
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                    document.querySelector('.install-prompt')?.remove();
                });
            }
        }
        
        function dismissInstallPrompt(button) {
            localStorage.setItem('installPromptDismissed', 'true');
            button.closest('.install-prompt').remove();
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide React icons as simple SVGs
        const icons = {
            Zap: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('polygon', { points: '13 2 3 14 12 14 11 22 21 10 12 10 13 2' })
            ),
            Plus: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'm12 5v14' }),
                React.createElement('path', { d: 'm5 12h14' })
            ),
            Edit: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1' }),
                React.createElement('path', { d: 'M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3l8.385-8.415Z' })
            ),
            Trash2: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'm3 6h18' }),
                React.createElement('path', { d: 'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6' }),
                React.createElement('path', { d: 'M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2' })
            ),
            BarChart3: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'M3 3v18h18' }),
                React.createElement('path', { d: 'M18 17V9' }),
                React.createElement('path', { d: 'M13 17V5' }),
                React.createElement('path', { d: 'M8 17v-3' })
            ),
            Download: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
                React.createElement('polyline', { points: '7,10 12,15 17,10' }),
                React.createElement('line', { x1: 12, y1: 15, x2: 12, y2: 3 })
            ),
            AlertTriangle: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'm21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z' }),
                React.createElement('path', { d: 'm12 9v4' }),
                React.createElement('path', { d: 'm12 17h.01' })
            ),
            CheckCircle: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14' }),
                React.createElement('polyline', { points: '22,4 12,14.01 9,11.01' })
            ),
            ArrowLeft: () => React.createElement('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round' }, 
                React.createElement('path', { d: 'm12 19-7-7 7-7' }),
                React.createElement('path', { d: 'M19 12H5' })
            )
        };

        const ElectricityMeterTracker = () => {
            const [meters, setMeters] = useState([]);
            const [readings, setReadings] = useState([]);
            const [monthlyRecords, setMonthlyRecords] = useState([]);
            const [currentView, setCurrentView] = useState('dashboard');
            const [selectedMeter, setSelectedMeter] = useState(null);
            const [editingMeter, setEditingMeter] = useState(null);
            
            const [newMeter, setNewMeter] = useState({
                meterNumber: '',
                nickname: '',
                type: 'single-phase',
                baseReading: ''
            });
            
            const [newReading, setNewReading] = useState({
                date: new Date().toISOString().split('T')[0],
                reading: '',
                endOfCycle: false
            });

            // Local Storage Functions
            const saveToStorage = (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }
            };

            const loadFromStorage = (key, defaultValue = []) => {
                try {
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : defaultValue;
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                    return defaultValue;
                }
            };

            // Load data from localStorage on component mount
            useEffect(() => {
                const storedMeters = loadFromStorage('meters');
                const storedReadings = loadFromStorage('readings');
                const storedMonthlyRecords = loadFromStorage('monthlyRecords');
                
                if (storedMeters.length === 0 && storedReadings.length === 0) {
                    // Initialize with sample data only if no stored data
                    const sampleMeters = [
                        { id: 1, meterNumber: 'MT001', nickname: 'Main Meter', type: 'single-phase', baseReading: 1000, currentReading: 1150 },
                        { id: 2, meterNumber: 'MT002', nickname: 'Backup Meter', type: 'three-phase', baseReading: 500, currentReading: 580 }
                    ];
                    
                    const sampleReadings = [
                        { id: 1, meterId: 1, date: '2025-09-01', reading: 1100, endOfCycle: false },
                        { id: 2, meterId: 1, date: '2025-09-02', reading: 1150, endOfCycle: false },
                        { id: 3, meterId: 2, date: '2025-09-01', reading: 550, endOfCycle: false },
                        { id: 4, meterId: 2, date: '2025-09-02', reading: 580, endOfCycle: false }
                    ];
                    
                    setMeters(sampleMeters);
                    setReadings(sampleReadings);
                    setMonthlyRecords([]);
                    
                    saveToStorage('meters', sampleMeters);
                    saveToStorage('readings', sampleReadings);
                    saveToStorage('monthlyRecords', []);
                } else {
                    setMeters(storedMeters);
                    setReadings(storedReadings);
                    setMonthlyRecords(storedMonthlyRecords);
                }
            }, []);

            // Save data to localStorage whenever state changes
            useEffect(() => {
                if (meters.length > 0) {
                    saveToStorage('meters', meters);
                }
            }, [meters]);

            useEffect(() => {
                if (readings.length > 0) {
                    saveToStorage('readings', readings);
                }
            }, [readings]);

            useEffect(() => {
                if (monthlyRecords.length > 0) {
                    saveToStorage('monthlyRecords', monthlyRecords);
                }
            }, [monthlyRecords]);

            const addMeter = () => {
                if (!newMeter.meterNumber || !newMeter.nickname || !newMeter.baseReading) {
                    alert('Please fill all meter details');
                    return;
                }
                
                const meter = {
                    id: Date.now(),
                    ...newMeter,
                    baseReading: parseFloat(newMeter.baseReading),
                    currentReading: parseFloat(newMeter.baseReading)
                };
                
                const updatedMeters = [...meters, meter];
                setMeters(updatedMeters);
                setNewMeter({ meterNumber: '', nickname: '', type: 'single-phase', baseReading: '' });
                setCurrentView('dashboard');
            };

            const updateMeter = () => {
                if (!editingMeter.meterNumber || !editingMeter.nickname || !editingMeter.baseReading) {
                    alert('Please fill all meter details');
                    return;
                }
                
                const updatedMeters = meters.map(m => m.id === editingMeter.id ? editingMeter : m);
                setMeters(updatedMeters);
                setEditingMeter(null);
                setCurrentView('dashboard');
            };

            const deleteMeter = (meterId) => {
                if (window.confirm('Are you sure you want to delete this meter and all its readings?')) {
                    const updatedMeters = meters.filter(m => m.id !== meterId);
                    const updatedReadings = readings.filter(r => r.meterId !== meterId);
                    setMeters(updatedMeters);
                    setReadings(updatedReadings);
                }
            };

            const addReading = () => {
                if (!newReading.reading) {
                    alert('Please enter the reading');
                    return;
                }
                
                const currentReading = parseFloat(newReading.reading);
                const meterReadings = readings.filter(r => r.meterId === selectedMeter.id).sort((a, b) => new Date(b.date) - new Date(a.date));
                const lastReading = meterReadings[0];
                
                if (lastReading && currentReading <= lastReading.reading) {
                    alert('Current reading must be higher than the previous reading');
                    return;
                }
                
                const reading = {
                    id: Date.now(),
                    meterId: selectedMeter.id,
                    date: newReading.date,
                    reading: currentReading,
                    endOfCycle: newReading.endOfCycle
                };
                
                // Update meter's current reading
                const updatedMeters = meters.map(m => m.id === selectedMeter.id ? {...m, currentReading} : m);
                setMeters(updatedMeters);
                
                // Add reading
                const updatedReadings = [...readings, reading];
                setReadings(updatedReadings);
                
                // Handle end of cycle
                if (newReading.endOfCycle) {
                    handleEndOfCycle(updatedReadings, updatedMeters);
                }
                
                setNewReading({ date: new Date().toISOString().split('T')[0], reading: '', endOfCycle: false });
                setCurrentView('dashboard');
            };

            const handleEndOfCycle = (currentReadings, currentMeters) => {
                const currentMonth = new Date().toISOString().slice(0, 7);
                let totalUsage = 0;
                const meterUsages = [];
                
                currentMeters.forEach(meter => {
                    const usage = meter.currentReading - meter.baseReading;
                    totalUsage += Math.max(0, usage);
                    meterUsages.push({ meterId: meter.id, usage: Math.max(0, usage) });
                    
                    // Reset meter base reading to current reading
                    setMeters(prev => prev.map(m => m.id === meter.id ? {...m, baseReading: meter.currentReading} : m));
                });
                
                // Add monthly record
                const monthlyRecord = {
                    id: Date.now(),
                    month: currentMonth,
                    totalUsage,
                    meters: meterUsages
                };
                
                const updatedMonthlyRecords = [...monthlyRecords, monthlyRecord];
                setMonthlyRecords(updatedMonthlyRecords);
            };

            const getCurrentMonthUsage = (meterId) => {
                const meter = meters.find(m => m.id === meterId);
                if (!meter) return 0;
                return Math.max(0, meter.currentReading - meter.baseReading);
            };

            const getTotalCurrentUsage = () => {
                return meters.reduce((total, meter) => total + getCurrentMonthUsage(meter.id), 0);
            };

            const getLastReadingDate = (meterId) => {
                const meterReadings = readings.filter(r => r.meterId === meterId).sort((a, b) => new Date(b.date) - new Date(a.date));
                return meterReadings[0]?.date || 'No readings';
            };

            const getDaysSinceLastReading = (meterId) => {
                const lastDate = getLastReadingDate(meterId);
                if (lastDate === 'No readings') return 'N/A';
                
                const today = new Date();
                const last = new Date(lastDate);
                const diffTime = Math.abs(today - last);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            };

            const exportToCSV = () => {
                const csvData = readings.map(reading => {
                    const meter = meters.find(m => m.id === reading.meterId);
                    return {
                        Date: reading.date,
                        MeterNumber: meter?.meterNumber,
                        Nickname: meter?.nickname,
                        Reading: reading.reading,
                        EndOfCycle: reading.endOfCycle ? 'Yes' : 'No'
                    };
                });
                
                const headers = Object.keys(csvData[0] || {});
                const csvContent = [
                    headers.join(','),
                    ...csvData.map(row => headers.map(header => row[header]).join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                a.setAttribute('download', 'electricity_readings.csv');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Show confirmation
                alert('Data exported successfully!');
            };

            const totalUsage = getTotalCurrentUsage();
            const usagePercentage = (totalUsage / 200) * 100;

            // Dashboard View
            if (currentView === 'dashboard') {
                return (
                    <div className="min-h-screen bg-gray-50 pb-20">
                        {/* Header */}
                        <div className="bg-white shadow-sm sticky top-0 z-40">
                            <div className="px-4 py-4">
                                <div className="flex justify-between items-center">
                                    <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                        <icons.Zap className="text-yellow-500 w-6 h-6" />
                                        Meter Tracker
                                    </h1>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setCurrentView('reports')}
                                            className="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors"
                                        >
                                            <icons.BarChart3 className="w-5 h-5" />
                                        </button>
                                        <button
                                            onClick={exportToCSV}
                                            className="p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors"
                                        >
                                            <icons.Download className="w-5 h-5" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="px-4 pt-4">
                            {/* Current Month Usage Overview */}
                            <div className="bg-blue-50 p-4 rounded-lg mb-6">
                                <h3 className="font-semibold text-blue-800 mb-2">Current Month Usage</h3>
                                <p className="text-2xl font-bold text-blue-600 mb-2">{totalUsage.toFixed(1)} / 200 units</p>
                                <div className="w-full bg-blue-200 rounded-full h-3">
                                    <div 
                                        className={`h-3 rounded-full transition-all duration-300 ${
                                            usagePercentage > 90 ? 'bg-red-500' : usagePercentage > 75 ? 'bg-orange-500' : 'bg-blue-600'
                                        }`}
                                        style={{width: `${Math.min(100, usagePercentage)}%`}}
                                    ></div>
                                </div>
                                <p className="text-sm text-blue-700 mt-1">{(200 - totalUsage).toFixed(1)} units remaining</p>
                            </div>

                            {/* Meter Cards */}
                            <div className="grid grid-cols-1 gap-4 mb-6">
                                {meters.map(meter => {
                                    const usage = getCurrentMonthUsage(meter.id);
                                    const daysSince = getDaysSinceLastReading(meter.id);
                                    
                                    return (
                                        <div key={meter.id} className="bg-white rounded-lg shadow-lg p-4 meter-card">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="flex-1">
                                                    <h3 className="font-bold text-lg text-gray-800">{meter.nickname}</h3>
                                                    <p className="text-sm text-gray-600">#{meter.meterNumber}</p>
                                                    <span className={`inline-block px-2 py-1 rounded text-xs mt-1 ${
                                                        meter.type === 'single-phase' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
                                                    }`}>
                                                        {meter.type}
                                                    </span>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            setEditingMeter({...meter});
                                                            setCurrentView('editMeter');
                                                        }}
                                                        className="p-2 text-gray-500 hover:text-blue-600"
                                                    >
                                                        <icons.Edit className="w-4 h-4" />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteMeter(meter.id)}
                                                        className="p-2 text-gray-500 hover:text-red-600"
                                                    >
                                                        <icons.Trash2 className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-2 mb-4">
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-600">Current Reading:</span>
                                                    <span className="font-semibold">{meter.currentReading}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-600">Monthly Usage:</span>
                                                    <span className="font-semibold text-blue-600">{usage.toFixed(1)} units</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-600">Last Reading:</span>
                                                    <span className="font-semibold">{daysSince === 'N/A' ? daysSince : `${daysSince} days ago`}</span>
                                                </div>
                                            </div>
                                            
                                            <button
                                                onClick={() => {
                                                    setSelectedMeter(meter);
                                                    setCurrentView('addReading');
                                                }}
                                                className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                            >
                                                Add Reading
                                            </button>
                                        </div>
                                    );
                                })}
                                
                                {/* Add New Meter Card */}
                                <div className="bg-white rounded-lg shadow-lg p-6 border-2 border-dashed border-gray-300 flex items-center justify-center meter-card">
                                    <button
                                        onClick={() => setCurrentView('addMeter')}
                                        className="flex flex-col items-center gap-2 text-gray-500 hover:text-blue-600 transition-colors py-4"
                                    >
                                        <icons.Plus className="w-8 h-8" />
                                        <span className="font-semibold">Add New Meter</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Add Meter View
            if (currentView === 'addMeter') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm sticky top-0 z-40">
                            <div className="px-4 py-4 flex items-center gap-3">
                                <button
                                    onClick={() => setCurrentView('dashboard')}
                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <icons.ArrowLeft className="w-5 h-5" />
                                </button>
                                <h2 className="text-xl font-bold">Add New Meter</h2>
                            </div>
                        </div>
                        
                        <div className="px-4 pt-4">
                            <div className="bg-white rounded-lg shadow-lg p-4">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Meter Number</label>
                                        <input
                                            type="text"
                                            value={newMeter.meterNumber}
                                            onChange={(e) => setNewMeter({...newMeter, meterNumber: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="e.g., MT001"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Nickname</label>
                                        <input
                                            type="text"
                                            value={newMeter.nickname}
                                            onChange={(e) => setNewMeter({...newMeter, nickname: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="e.g., Main Meter"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Type</label>
                                        <select
                                            value={newMeter.type}
                                            onChange={(e) => setNewMeter({...newMeter, type: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        >
                                            <option value="single-phase">Single Phase</option>
                                            <option value="three-phase">Three Phase</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Base Reading</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={newMeter.baseReading}
                                            onChange={(e) => setNewMeter({...newMeter, baseReading: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Current meter reading"
                                        />
                                    </div>
                                </div>
                                
                                <div className="flex gap-3 mt-6">
                                    <button
                                        onClick={addMeter}
                                        className="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                    >
                                        Add Meter
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('dashboard')}
                                        className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Edit Meter View
            if (currentView === 'editMeter') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm sticky top-0 z-40">
                            <div className="px-4 py-4 flex items-center gap-3">
                                <button
                                    onClick={() => {
                                        setEditingMeter(null);
                                        setCurrentView('dashboard');
                                    }}
                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <icons.ArrowLeft className="w-5 h-5" />
                                </button>
                                <h2 className="text-xl font-bold">Edit Meter</h2>
                            </div>
                        </div>
                        
                        <div className="px-4 pt-4">
                            <div className="bg-white rounded-lg shadow-lg p-4">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Meter Number</label>
                                        <input
                                            type="text"
                                            value={editingMeter.meterNumber}
                                            onChange={(e) => setEditingMeter({...editingMeter, meterNumber: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Nickname</label>
                                        <input
                                            type="text"
                                            value={editingMeter.nickname}
                                            onChange={(e) => setEditingMeter({...editingMeter, nickname: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Type</label>
                                        <select
                                            value={editingMeter.type}
                                            onChange={(e) => setEditingMeter({...editingMeter, type: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        >
                                            <option value="single-phase">Single Phase</option>
                                            <option value="three-phase">Three Phase</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Base Reading</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={editingMeter.baseReading}
                                            onChange={(e) => setEditingMeter({...editingMeter, baseReading: parseFloat(e.target.value)})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                </div>
                                
                                <div className="flex gap-3 mt-6">
                                    <button
                                        onClick={updateMeter}
                                        className="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                    >
                                        Update Meter
                                    </button>
                                    <button
                                        onClick={() => {
                                            setEditingMeter(null);
                                            setCurrentView('dashboard');
                                        }}
                                        className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Add Reading View
            if (currentView === 'addReading') {
                const lastReading = readings
                    .filter(r => r.meterId === selectedMeter.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm sticky top-0 z-40">
                            <div className="px-4 py-4 flex items-center gap-3">
                                <button
                                    onClick={() => setCurrentView('dashboard')}
                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <icons.ArrowLeft className="w-5 h-5" />
                                </button>
                                <div className="flex-1">
                                    <h2 className="text-lg font-bold">Add Reading</h2>
                                    <p className="text-sm text-gray-600">{selectedMeter.nickname}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="px-4 pt-4">
                            <div className="bg-gray-50 p-4 rounded-lg mb-4">
                                <h3 className="font-semibold mb-3">Meter Information</h3>
                                <div className="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span className="text-gray-600">Meter Number:</span>
                                        <div className="font-semibold">{selectedMeter.meterNumber}</div>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Type:</span>
                                        <div className="font-semibold">{selectedMeter.type}</div>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Previous Reading:</span>
                                        <div className="font-semibold">{lastReading ? lastReading.reading : selectedMeter.baseReading}</div>
                                    </div>
                                    <div>
                                        <span className="text-gray-600">Current Usage:</span>
                                        <div className="font-semibold text-blue-600">{getCurrentMonthUsage(selectedMeter.id).toFixed(1)} units</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-lg shadow-lg p-4">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Date</label>
                                        <input
                                            type="date"
                                            value={newReading.date}
                                            onChange={(e) => setNewReading({...newReading, date: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Meter Reading</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={newReading.reading}
                                            onChange={(e) => setNewReading({...newReading, reading: e.target.value})}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder={`Must be greater than ${lastReading ? lastReading.reading : selectedMeter.baseReading}`}
                                        />
                                    </div>
                                    
                                    <div className="flex items-start gap-3">
                                        <input
                                            type="checkbox"
                                            id="endOfCycle"
                                            checked={newReading.endOfCycle}
                                            onChange={(e) => setNewReading({...newReading, endOfCycle: e.target.checked})}
                                            className="mt-1 w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                        />
                                        <label htmlFor="endOfCycle" className="text-sm font-medium">
                                            End of monthly cycle (200 unit cycle complete)
                                        </label>
                                    </div>
                                    
                                    {newReading.endOfCycle && (
                                        <div className="bg-yellow-50 border border-yellow-200 p-3 rounded-lg">
                                            <div className="flex items-start gap-2">
                                                <icons.AlertTriangle className="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" />
                                                <span className="text-sm font-medium text-yellow-800">
                                                    This will end the current cycle and reset all meters for the new month
                                                </span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="flex gap-3 mt-6">
                                    <button
                                        onClick={addReading}
                                        className="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                                    >
                                        Add Reading
                                    </button>
                                    <button
                                        onClick={() => setCurrentView('dashboard')}
                                        className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Reports View
            if (currentView === 'reports') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm sticky top-0 z-40">
                            <div className="px-4 py-4 flex items-center gap-3">
                                <button
                                    onClick={() => setCurrentView('dashboard')}
                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <icons.ArrowLeft className="w-5 h-5" />
                                </button>
                                <h2 className="text-xl font-bold">Reports</h2>
                            </div>
                        </div>
                        
                        <div className="px-4 pt-4 pb-6">
                            {/* Current Month Summary */}
                            <div className="grid grid-cols-1 gap-4 mb-6">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-blue-800 mb-3">Current Month Summary</h4>
                                    <div className="space-y-2">
                                        <div className="flex justify-between">
                                            <span>Total Usage:</span>
                                            <span className="font-semibold">{totalUsage.toFixed(1)} units</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Remaining:</span>
                                            <span className="font-semibold">{(200 - totalUsage).toFixed(1)} units</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Progress:</span>
                                            <span className="font-semibold">{usagePercentage.toFixed(1)}%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="bg-green-50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-green-800 mb-3">Meter Usage Breakdown</h4>
                                    <div className="space-y-2">
                                        {meters.map(meter => (
                                            <div key={meter.id} className="flex justify-between">
                                                <span>{meter.nickname}:</span>
                                                <span className="font-semibold">{getCurrentMonthUsage(meter.id).toFixed(1)} units</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Monthly Records */}
                            <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                                <h3 className="text-lg font-semibold mb-4">Monthly History</h3>
                                <div className="space-y-3">
                                    {monthlyRecords.length === 0 ? (
                                        <p className="text-gray-500 text-center py-4">No completed monthly cycles yet</p>
                                    ) : (
                                        monthlyRecords.map(record => (
                                            <div key={record.id} className="border rounded-lg p-3">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="font-medium">{record.month}</span>
                                                    <span className={`px-2 py-1 rounded text-xs ${
                                                        record.totalUsage <= 200 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                    }`}>
                                                        {record.totalUsage} units
                                                    </span>
                                                </div>
                                                <div className="text-sm text-gray-600">
                                                    {record.meters.map(meterUsage => {
                                                        const meter = meters.find(m => m.id === meterUsage.meterId);
                                                        return (
                                                            <div key={meterUsage.meterId}>
                                                                {meter?.nickname}: {meterUsage.usage} units
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                            
                            {/* All Readings */}
                            <div className="bg-white rounded-lg shadow-lg p-4">
                                <h3 className="text-lg font-semibold mb-4">Recent Readings</h3>
                                <div className="space-y-3">
                                    {readings.length === 0 ? (
                                        <p className="text-gray-500 text-center py-4">No readings recorded yet</p>
                                    ) : (
                                        readings
                                            .sort((a, b) => new Date(b.date) - new Date(a.date))
                                            .slice(0, 10)
                                            .map(reading => {
                                                const meter = meters.find(m => m.id === reading.meterId);
                                                return (
                                                    <div key={reading.id} className="flex justify-between items-center border-b pb-2">
                                                        <div>
                                                            <div className="font-medium">{meter?.nickname}</div>
                                                            <div className="text-sm text-gray-600">{reading.date}</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="font-semibold">{reading.reading}</div>
                                                            {reading.endOfCycle && (
                                                                <icons.CheckCircle className="w-4 h-4 text-green-600 ml-auto" />
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        ReactDOM.render(<ElectricityMeterTracker />, document.getElementById('root'));
    </script>
</body>
</html>